version: 2
updates:

  # Automatic upgrade for go modules.
  - package-ecosystem: "gomod"
    directories: ["/", "/cmd"]
    groups:
      go:
        # Group all of our updates in one PR.
        # This is mostly because this is the best way we could find
        # to group both go.mod and cmd/go.mod updates in one PR,
        # but ideally we should have one PR per unique dependency.
        patterns:
          - '*'
    schedule:
      interval: "daily"
    ignore:
      # skip grpc because the current latest not compatible with containerd 1.7
      # skip k8s deps since they use the latest go version/features that may
      # not be in the go version soci uses
      - dependency-name: "github.com/awslabs/soci-snapshotter"
      - dependency-name: "google.golang.org/grpc"
      - dependency-name: "k8s.io/*"

  # Automatic update for base images used in the Dockerfile
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "daily"
    ignore:
      # Skip major and minor updates for the base Go image.
      # Major updates should not occur.
      # Minor updates for the Go toolchain should be done manually to be aligned with release CI.
      - dependency-name: "docker/library/golang"
        update-types: ["version-update:semver-major", "version-update:semver-minor"]

  # Automatic upgrade for Github Actions
  - package-ecosystem: "github-actions"
    directory: "/" # means ".github/workflows"
    schedule:
      interval: "daily"
